# -*- coding: utf-8 -*-
"""Chapter10:【演習問題: 解答用】Agents

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1hBT0BtJaPk1sXkDcBponhFLlMzeWSTV3

# Lesson14: LangChainの主要モジュール5【Agents（AIエージェント）】
# Chapter10:【演習問題: 解答用】Agents

事前準備を行った上で、2つの演習問題に取り組みましょう。

各問題の「回答例/正解」と「解説」はデフォルトで非表示としていますが、  
非表示セルをクリックすれば確認できます。

まずは「回答例/正解」と「解説」を見ずにトライしてみましょう。

## 事前準備

シークレット機能でOpenAI APIのAPIキーを設定し、以下2つのコードを実行しましょう。
"""

import os
from google.colab import userdata

os.environ["OPENAI_API_KEY"] = userdata.get("OPENAI_API_KEY")

!pip install langchain==0.3.0 openai==1.47.0 langchain-community==0.3.0 httpx==0.27.2 pydantic==2.9.2

"""## 演習問題

### 【問題1】
入力ジャンルに応じておすすめの本を提案する、Toolに渡す用の関数が定義されています。  
この関数を使い、Toolを作ってください。

※「name」と「description」について、よく考えて適切な文言を設定してください。
"""

from langchain.tools import Tool

def recommend_books(genre):
    recommendations = {
        "SF": "『月面都市の秘密』 by ジェイムズ・L・コナー",
        "ファンタジー": "『龍の涙』 by ローラン・ド・シャルル",
        "ミステリー": "『失われたパズル』 by マーカス・D・ブラッドショウ",
    }
    recommendation_book = recommendations[genre]
    return recommendation_book

answer_tool = Tool.from_function(
    func=recommend_books,
    name="おすすめの本を提案",
    description="入力ジャンルに応じておすすめの本を提案"
)

"""#### 【解答例】"""

book_recommendation_tool = Tool.from_function(
    func=recommend_books,
    name="おすすめの本案内",
    description="ジャンルに基づいておすすめの本を答える"
)

"""#### 【解説】

「name」と「description」を適切に設定することで、エージェントが期待通りの場面でToolを選択してくれるようになります。

### 【問題2】
以下の条件に従って、AIエージェントのシステムを作ってください。

**【条件】**
*   「マーケティング」「営業」「採用」のそれぞれのテーマごとに、戦略構築を行うToolを作ってください。
*   プロンプトのシステムメッセージには、それぞれ用意されている以下のものを使ってください。
*   作成した3つのToolをエージェントに渡し、ユーザー入力値に応じて適切なToolが選ばれるようにしてください。
*   ユーザー入力値は、あらかじめ用意されている3つを順に使ってエージェントを実行してください。
*   各ユーザー入力値に対して期待通りのToolが選択されていることを、実行ログで確認してください。

**【マーケティング戦略の専門家AI作成用プロンプト】**  
あなたはマーケティング戦略の専門家AIです。ユーザーが提供する情報をもとに、ターゲット市場の分析、マーケティング戦略の立案、キャンペーンの最適化に関するアドバイスを行います。具体的かつ実行可能な提案を提供し、現代のデジタルマーケティングのトレンドを考慮してください。

**【営業戦略の専門家AI作成用プロンプト】**  
あなたは営業戦略の専門家AIです。ユーザーが提供するターゲット市場や商材に基づき、最適な営業戦略を立案します。リードの獲得方法、クロージング手法、競合他社との差別化ポイントについて具体的な提案を行ってください。

**【採用戦略の専門家AI作成用プロンプト】**  
あなたは採用戦略の専門家AIです。企業の規模、採用人数、業界特性を考慮し、効果的な採用チャネルやプロセスを提案します。予算やターゲット層に合わせた戦略を具体的に提示してください。

#### 【ヒント】

当LessonのChapter7のコードを見ながら解くと、楽かと思います。

#### 【解答】
"""

query1 = """
私たちは「EcoGlowスキンセラム」という新しいスキンケア商品を販売しようとしています。この商品は、オーガニック成分100%で作られており、環境に配慮したリサイクル可能なパッケージを採用しています。また、全ての肌タイプに対応しており、特に敏感肌の方でも安心して使用できるのが特徴です。価格は1本3,500円で、プレミアム感を保ちながらも手の届きやすい価格設定を意識しました。
ターゲット層は25～35歳の女性で、美容や健康に関心が高く、環境問題にも配慮したライフスタイルを重視する層を想定しています。職業は会社員やフリーランスの方が中心で、日常的にSNSを活用している人々が多いと考えています。この層は、InstagramやTikTokの広告やインフルエンサーの投稿から情報を得る傾向が強く、そうしたチャネルを通じたマーケティングが効果的だと考えています。
現在の課題として、ブランドの認知度がまだ低いため、ターゲット層に商品をどのように届けるかが大きなポイントになっています。特に、どのSNSプラットフォームに重点を置くべきか、どのようなキャンペーンが最も効果的かを知りたいです。競合製品としては、同価格帯の「GreenSkinエッセンス」や「PureEarthセラム」がありますが、これらはオーガニック成分を謳いながらも、環境配慮型パッケージではないことが当社商品の差別化ポイントとなります。
マーケティング予算は月額50万円で、主にSNS広告とインフルエンサーマーケティングに配分する予定です。ただし、具体的な配分方法や費用対効果を最大化する施策についてのアドバイスを求めています。また、商品ローンチ後3ヶ月間で、売上100万円を達成することを目標としており、そのための具体的なステップやキャンペーンアイデアを提案してほしいです。
"""

query2 = """
当社は、食品業界向けの在庫管理システム「SmartStock」を提供しています。このシステムは、中小規模の食品製造業者や卸売業者を主なターゲットとしており、在庫の過剰や不足を防ぎ、効率的なサプライチェーン管理を実現することを目的としています。主要な機能としては、リアルタイム在庫追跡、自動発注機能、分析レポートの作成が挙げられます。他社製品と比較して、導入コストが低い点と、業界特化型の機能（例: 消費期限の管理や温度調整が必要な在庫の分類機能）が差別化ポイントとなります。
ターゲット市場は、年商3億円～20億円規模の中小企業です。この市場では、既存の手作業やExcelベースの在庫管理に限界を感じている企業が多く、システム化の必要性を認識しているものの、高額な導入コストが障壁となっているケースが多いです。そのため、当社では初期導入費用を抑えたプランを提供し、利用開始後6ヶ月間の無料サポートを付帯しています。
現在の課題として、営業活動の初期段階でリードを十分に獲得できていないことがあります。具体的には、ターゲット企業にシステム導入の利点を効果的に伝えることができておらず、問い合わせやデモ依頼の件数が目標値に達していません。これにより、営業プロセス全体の成約率が低下している状況です。
また、競合としては「InventoryPro」や「StockManager」などの製品が挙げられます。これらは大企業向けの高機能システムとして知られており、当社の価格優位性や業界特化型機能とは異なる強みを持っています。ただし、競合製品に比べて当社はブランド認知度が低いため、営業活動における説得力を補完するための明確な差別化ポイントやデータを提示する必要があります。
当社の営業予算は月額100万円で、主にターゲット企業への訪問営業、ウェビナーの実施、業界誌への広告出稿に使用しています。しかし、どのチャネルが最も効果的か明確ではないため、費用対効果を最大化するための戦略を再構築したいと考えています。
目標として、今後6ヶ月間で30社の新規顧客を獲得することを設定しており、そのために具体的なリード獲得施策やクロージング手法、競合との差別化を強調する営業資料の改善アイデアを求めています。
"""

query3 = """
当社は、従業員数30名のデザインスタジオで、クライアントに対してグラフィックデザイン、UI/UX設計、ブランディングサポートを提供しています。事業拡大に伴い、2名の新規デザイナーを採用する計画を進めています。具体的には、1名のUI/UXデザイナーと1名のグラフィックデザイナーを募集しています。UI/UXデザイナーは、クライアントのウェブサイトやモバイルアプリの設計を担当し、グラフィックデザイナーは広告キャンペーンやブランド構築のためのビジュアル作成を主な業務とします。
ターゲット層としては、UI/UXデザイナーは20代後半から30代半ばの中堅層を想定しており、SketchやFigmaなどのデザインツールに精通し、ユーザビリティに関する基本的な知識を持つ人材を求めています。一方、グラフィックデザイナーは経験1～3年程度の若手層をターゲットにしており、IllustratorやPhotoshopのスキルに加えて、コンテンツ制作に柔軟に対応できる方を希望しています。
現在の採用課題は、業界の中で当社が比較的小規模であるため、知名度が低く、応募者数が限られていることです。また、UI/UXデザイナーのポジションについては、クライアントとのやり取りやチームとの協調性が求められるため、技術力だけでなく、コミュニケーションスキルを兼ね備えた人材の採用が難航しています。加えて、採用予算が月額10万円と限られているため、コストを抑えた効率的な採用活動が求められています。
これまでに試みた採用手段として、主要な求人サイトやSNSを利用しましたが、応募者数は目標を下回っており、さらに希望条件に合う候補者が少ない状況です。一方で、デザイン業界のコミュニティイベントやポートフォリオ展示会では、応募意欲の高い候補者との接点を得ることができました。
今後3ヶ月以内に2名の採用を完了し、プロジェクトの稼働率を向上させることが目標です。特に、当社の独自性や働きやすさをアピールするための効果的な求人広告の作成方法、ターゲット層にリーチするチャネル選定、そして予算内で実現可能な採用イベントのアイデアについて具体的な提案を求めています。また、入社後の業務へのスムーズな適応を促すため、入社初月のトレーニングプログラムについてもアドバイスをいただきたいです。
"""

from langchain.chat_models import ChatOpenAI
from langchain.prompts import ChatPromptTemplate
from langchain import LLMChain

def result_chain(param, system_template):
    llm = ChatOpenAI(model_name="gpt-4o-mini", temperature=0.5)
    prompt = ChatPromptTemplate.from_messages([
        ("system", system_template),
        ("human", "{input}")
    ])
    chain = LLMChain(prompt=prompt, llm=llm)
    result = chain.run(param)
    return result

from langchain.tools import Tool

def marketing_strategy_advice(param):

    system_template = """
    あなたはマーケティング戦略の専門家AIです。
    ユーザーが提供する情報をもとに、ターゲット市場の分析、マーケティング戦略の立案、キャンペーンの最適化に関するアドバイスを行います。
    具体的かつ実行可能な提案を提供し、現代のデジタルマーケティングのトレンドを考慮してください。
    """
    result = result_chain(param, system_template)
    return result

marketing_strategy_advice_tool = Tool.from_function(
    func=marketing_strategy_advice,
    name="マーケティング戦略の専門家AI",
    description="ユーザーが提供する情報をもとに、ターゲット市場の分析、マーケティング戦略の立案、キャンペーンの最適化に関するアドバイスを行なう"
)

from langchain.tools import Tool

def sales_strategy_advice(param):
    system_template = """
    あなたは営業戦略の専門家AIです。
    ユーザーが提供するターゲット市場や商材に基づき、最適な営業戦略を立案します。
    リードの獲得方法、クロージング手法、競合他社との差別化ポイントについて具体的な提案を行ってください。
    """
    result = result_chain(param, system_template)
    return result

sales_strategy_advice_tool = Tool.from_function(
    func=sales_strategy_advice,
    name="営業戦略の専門家AI",
    description="ユーザーが提供するターゲット市場や商材に基づき、最適な営業戦略を立案"
)

from langchain.tools import Tool

def recruitment_strategy_advice(param):
    system_template = """
    あなたは採用戦略の専門家AIです。
    企業の規模、採用人数、業界特性を考慮し、効果的な採用チャネルやプロセスを提案します。
    予算やターゲット層に合わせた戦略を具体的に提示してください。
    """
    result = result_chain(param, system_template)
    return result

recruitment_strategy_advice_tool = Tool.from_function(
    func=recruitment_strategy_advice,
    name="採用戦略の専門家AI",
    description="企業の規模、採用人数、業界特性を考慮し、効果的な採用チャネルやプロセスを提案"
)

from langchain.agents import AgentType, initialize_agent, load_tools

tools = [
    # マーケティング戦略ツール
    marketing_strategy_advice_tool,
    # 営業戦略ツール
    sales_strategy_advice_tool,
    # 採用戦略ツール
    recruitment_strategy_advice_tool
]

agent_executor = initialize_agent(
    llm=llm,
    tools=tools,
    agent=AgentType.ZERO_SHOT_REACT_DESCRIPTION,
    verbose=True
)

agent_executor.run(query1)

agent_executor.run(query2)

agent_executor.run(query3)







"""#### 【解答例】"""

from langchain.chat_models import ChatOpenAI
from langchain.prompts import ChatPromptTemplate
from langchain import LLMChain

def result_chain(param, system_template):
    llm = ChatOpenAI(model_name="gpt-4o-mini", temperature=0.5)

    prompt = ChatPromptTemplate.from_messages([
        ("system", system_template),
        ("human", "{input}")
    ])

    chain = LLMChain(prompt=prompt, llm=llm)

    result = chain.run(param)
    return result

from langchain.tools import Tool

def get_marketing_advice(param):
    system_template = """
    あなたはマーケティング戦略の専門家AIです。ユーザーが提供する情報をもとに、
    ターゲット市場の分析、マーケティング戦略の立案、キャンペーンの最適化に関するアドバイスを行います。
    具体的かつ実行可能な提案を提供し、現代のデジタルマーケティングのトレンドを考慮してください。
    """

    result = result_chain(param, system_template)
    return result

marketing_advice_tool = Tool.from_function(
    func=get_marketing_advice,
    name="マーケティング戦略アドバイザー",
    description="""
        マーケティング戦略の立案、ターゲット市場の分析、キャンペーンの最適化について
        アドバイスを提供するツールです。ユーザーの入力をもとに、具体的かつ実行可能な提案を行います。
    """
)

def get_sales_advice(param):
    system_template = """
    あなたは営業戦略の専門家AIです。ユーザーが提供するターゲット市場や商材に基づき、
    最適な営業戦略を立案します。リードの獲得方法、クロージング手法、
    競合他社との差別化ポイントについて具体的な提案を行ってください。
    """

    result = result_chain(param, system_template)
    return result

sales_advice_tool = Tool.from_function(
    func=get_sales_advice,
    name="営業戦略アドバイザー",
    description="""
        ターゲット市場や商材に基づいて最適な営業戦略を立案するツールです。
        リードの獲得方法、クロージング手法、競合他社との差別化ポイントについて具体的なアドバイスを提供します。
    """
)

def get_recruit_advice(param):
    system_template = """
    あなたは採用戦略の専門家AIです。企業の規模、採用人数、業界特性を考慮し、
    効果的な採用チャネルやプロセスを提案します。
    予算やターゲット層に合わせた戦略を具体的に提示してください。
    """

    result = result_chain(param, system_template)
    return result

recruit_advice_tool = Tool.from_function(
    func=get_recruit_advice,
    name="採用戦略アドバイザー",
    description="""
        企業の規模や採用ニーズ、業界特性に基づいて効果的な採用戦略を提案するツールです。
        予算やターゲット層に合わせた採用チャネルやプロセスを具体的にアドバイスします。
    """
)

from langchain.agents import AgentType, initialize_agent, load_tools

llm = ChatOpenAI(model_name="gpt-4o-mini", temperature=0.5)

tools = [
    marketing_advice_tool,
    sales_advice_tool,
    recruit_advice_tool
]

agent_executor = initialize_agent(
    llm=llm,
    tools=tools,
    agent=AgentType.ZERO_SHOT_REACT_DESCRIPTION,
    verbose=True
)

query1 = """
私たちは「EcoGlowスキンセラム」という新しいスキンケア商品を販売しようとしています。この商品は、オーガニック成分100%で作られており、環境に配慮したリサイクル可能なパッケージを採用しています。また、全ての肌タイプに対応しており、特に敏感肌の方でも安心して使用できるのが特徴です。価格は1本3,500円で、プレミアム感を保ちながらも手の届きやすい価格設定を意識しました。
ターゲット層は25～35歳の女性で、美容や健康に関心が高く、環境問題にも配慮したライフスタイルを重視する層を想定しています。職業は会社員やフリーランスの方が中心で、日常的にSNSを活用している人々が多いと考えています。この層は、InstagramやTikTokの広告やインフルエンサーの投稿から情報を得る傾向が強く、そうしたチャネルを通じたマーケティングが効果的だと考えています。
現在の課題として、ブランドの認知度がまだ低いため、ターゲット層に商品をどのように届けるかが大きなポイントになっています。特に、どのSNSプラットフォームに重点を置くべきか、どのようなキャンペーンが最も効果的かを知りたいです。競合製品としては、同価格帯の「GreenSkinエッセンス」や「PureEarthセラム」がありますが、これらはオーガニック成分を謳いながらも、環境配慮型パッケージではないことが当社商品の差別化ポイントとなります。
マーケティング予算は月額50万円で、主にSNS広告とインフルエンサーマーケティングに配分する予定です。ただし、具体的な配分方法や費用対効果を最大化する施策についてのアドバイスを求めています。また、商品ローンチ後3ヶ月間で、売上100万円を達成することを目標としており、そのための具体的なステップやキャンペーンアイデアを提案してほしいです。
"""

agent_executor.run(query1)

query2 = """
当社は、食品業界向けの在庫管理システム「SmartStock」を提供しています。このシステムは、中小規模の食品製造業者や卸売業者を主なターゲットとしており、在庫の過剰や不足を防ぎ、効率的なサプライチェーン管理を実現することを目的としています。主要な機能としては、リアルタイム在庫追跡、自動発注機能、分析レポートの作成が挙げられます。他社製品と比較して、導入コストが低い点と、業界特化型の機能（例: 消費期限の管理や温度調整が必要な在庫の分類機能）が差別化ポイントとなります。
ターゲット市場は、年商3億円～20億円規模の中小企業です。この市場では、既存の手作業やExcelベースの在庫管理に限界を感じている企業が多く、システム化の必要性を認識しているものの、高額な導入コストが障壁となっているケースが多いです。そのため、当社では初期導入費用を抑えたプランを提供し、利用開始後6ヶ月間の無料サポートを付帯しています。
現在の課題として、営業活動の初期段階でリードを十分に獲得できていないことがあります。具体的には、ターゲット企業にシステム導入の利点を効果的に伝えることができておらず、問い合わせやデモ依頼の件数が目標値に達していません。これにより、営業プロセス全体の成約率が低下している状況です。
また、競合としては「InventoryPro」や「StockManager」などの製品が挙げられます。これらは大企業向けの高機能システムとして知られており、当社の価格優位性や業界特化型機能とは異なる強みを持っています。ただし、競合製品に比べて当社はブランド認知度が低いため、営業活動における説得力を補完するための明確な差別化ポイントやデータを提示する必要があります。
当社の営業予算は月額100万円で、主にターゲット企業への訪問営業、ウェビナーの実施、業界誌への広告出稿に使用しています。しかし、どのチャネルが最も効果的か明確ではないため、費用対効果を最大化するための戦略を再構築したいと考えています。
目標として、今後6ヶ月間で30社の新規顧客を獲得することを設定しており、そのために具体的なリード獲得施策やクロージング手法、競合との差別化を強調する営業資料の改善アイデアを求めています。
"""

agent_executor.run(query2)

query3 = """
当社は、従業員数30名のデザインスタジオで、クライアントに対してグラフィックデザイン、UI/UX設計、ブランディングサポートを提供しています。事業拡大に伴い、2名の新規デザイナーを採用する計画を進めています。具体的には、1名のUI/UXデザイナーと1名のグラフィックデザイナーを募集しています。UI/UXデザイナーは、クライアントのウェブサイトやモバイルアプリの設計を担当し、グラフィックデザイナーは広告キャンペーンやブランド構築のためのビジュアル作成を主な業務とします。
ターゲット層としては、UI/UXデザイナーは20代後半から30代半ばの中堅層を想定しており、SketchやFigmaなどのデザインツールに精通し、ユーザビリティに関する基本的な知識を持つ人材を求めています。一方、グラフィックデザイナーは経験1～3年程度の若手層をターゲットにしており、IllustratorやPhotoshopのスキルに加えて、コンテンツ制作に柔軟に対応できる方を希望しています。
現在の採用課題は、業界の中で当社が比較的小規模であるため、知名度が低く、応募者数が限られていることです。また、UI/UXデザイナーのポジションについては、クライアントとのやり取りやチームとの協調性が求められるため、技術力だけでなく、コミュニケーションスキルを兼ね備えた人材の採用が難航しています。加えて、採用予算が月額10万円と限られているため、コストを抑えた効率的な採用活動が求められています。
これまでに試みた採用手段として、主要な求人サイトやSNSを利用しましたが、応募者数は目標を下回っており、さらに希望条件に合う候補者が少ない状況です。一方で、デザイン業界のコミュニティイベントやポートフォリオ展示会では、応募意欲の高い候補者との接点を得ることができました。
今後3ヶ月以内に2名の採用を完了し、プロジェクトの稼働率を向上させることが目標です。特に、当社の独自性や働きやすさをアピールするための効果的な求人広告の作成方法、ターゲット層にリーチするチャネル選定、そして予算内で実現可能な採用イベントのアイデアについて具体的な提案を求めています。また、入社後の業務へのスムーズな適応を促すため、入社初月のトレーニングプログラムについてもアドバイスをいただきたいです。
"""

agent_executor.run(query3)

"""#### 【解説】

ユーザー入力値に応じて別々の専門家AIを使うことで、回答精度を上げられます。
"""